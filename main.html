

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>The Effect of COVID-19 on U.S. Mobility: An Analysis of Google Community Mobility Reports &#8212; Group 24</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'main';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="#">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    The Effect of COVID-19 on U.S. Mobility: An Analysis of Google Community Mobility Reports
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fmain.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/main.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The Effect of COVID-19 on U.S. Mobility: An Analysis of Google Community Mobility Reports</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstract">Abstract</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-source">Data Source</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-analysis">Descriptive Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation-analysis">Correlation Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatiotemporal-trends-analysis">Spatiotemporal Trends Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#temporal-trends-by-date">Temporal Trends by Date</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#retail-and-recreation">Retail and Recreation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parks">Parks</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#transit-stations">Transit Stations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#grocery-and-pharmacy">Grocery and Pharmacy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#residential">Residential</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#workplaces">Workplaces</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-trends-by-state">Spatial Trends by State</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Retail and Recreation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Parks</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Transit Stations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Grocery and Pharmacy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Residential</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Workplaces</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dependency-analysis">Dependency Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analyze-covid-cases-by-state">Analyze covid cases by state</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-different-gathering-bans-affect-covid-affection-rate">How different gathering bans affect covid affection rate?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-covid-infection-rate-on-other-variables">regression covid infection rate on other variables</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#social-productivity-related-mobility-trends">Social Productivity-Related Mobility Trends</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mechanism-analysis-based-on-demand-modeling">Mechanism Analysis based on Demand Modeling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contribution-statement">Contribution statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="the-effect-of-covid-19-on-u-s-mobility-an-analysis-of-google-community-mobility-reports">
<h1>The Effect of COVID-19 on U.S. Mobility: An Analysis of Google Community Mobility Reports<a class="headerlink" href="#the-effect-of-covid-19-on-u-s-mobility-an-analysis-of-google-community-mobility-reports" title="Permalink to this heading">#</a></h1>
<section id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Permalink to this heading">#</a></h2>
<p>This study investigates the impact of the COVID-19 pandemic on mobility patterns in the United States using Google Community Mobility Reports. The research employs descriptive statistics, time-series analysis, and regression models to analyze the data. In order to understand the mechanism of epidemic spread on the community mobility, we modelled the demand-service relationship using the DQQ model which analyze disruptions and recoveries in complex systems in different contexts. The model can help decision-makers and practitioners develop strategies to mitigate the impact of disruptions, improve the resilience of systems, and enhance the recovery process. Furthermore, the model can be used to evaluate the effectiveness of different policies and interventions aimed at minimizing disruptions and accelerating the recovery process. The analysis results indicate significant changes in mobility patterns during the pandemic, with notable variations across different regions and sectors. The findings have implications for policymakers and future research on the long-term consequences of the pandemic on human mobility.</p>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>The COVID-19 pandemic, caused by the novel coronavirus SARS-CoV-2, has had an unprecedented impact on the lives of people worldwide since its initial outbreak in late 2019. The rapid spread of the virus led to significant disruptions in various sectors, including public health, economy, education, and transportation. Governments around the world implemented various measures to curb the spread of the virus, such as social distancing guidelines, stay-at-home orders, lockdowns, and travel restrictions. These measures significantly altered human behavior and societal norms, leading to widespread changes in mobility patterns.</p>
<p>Understanding the effect of COVID-19 on mobility is essential for several reasons. Firstly, changes in mobility patterns have direct implications for the spread of the virus, as reduced movement and social interactions can help mitigate transmission. Secondly, mobility changes affect economic activity, as restrictions on movement can impact businesses, particularly in sectors such as retail, hospitality, and tourism. Thirdly, the pandemic’s influence on mobility can have lasting social consequences, including changes in work patterns, commuting habits, and urban planning.</p>
<p>Existing studies have examined the effects of the pandemic on mobility patterns, generally indicating significant reductions in travel and movement, particularly during lockdown periods. Google Community Mobility Reports have emerged as a valuable data source for understanding these mobility changes, as they provide daily, anonymized, and aggregated data on movement trends across various categories. (Halford et. al., 2020) examine crime effects for one UK police force area in comparison to 5-year averages. (Nurjani et. al., 2021) study carbon emissions from the transportation sector during the covid-19 pandemic in the special region of yogyakarta, indonesia. The Covid-19 - Google Global Mobility Report was used to map trends of change in the respondents’ activity and mobility. (Trasberg et. al., 2021) find that the activities in the deprived areas dominated by minority groups declined less compared to the Greater London average, leaving those communities more exposed to the virus. (Munawar et. al., 2021) show that transport sector in Australia is facing a serious financial downfall as the use of public transport has dropped by 80%, a 31.5% drop in revenues earned by International airlines in Australia has been predicted, and a 9.5% reduction in the freight transport by water is expected. Federal, state, and local governments have placed multiple executive orders for human mobility reduction to slow down the spread of COVID-19. (Jiang et. al., 2021) use geotagged tweets data to reveal the spatiotemporal human mobility patterns during this COVID-19 pandemic in New York City. (Safitri et. al., 2021) focus on forecasting travel patterns during covid-19 period using community mobility report case study: bangka belitung province. A time series model is necessary to predict future mobility. (Setyowati et. al., 2021) study computer vision syndrome among academic community in mulawarman university, indonesia during work from home in covid-19 pandemic. All the respondents were asked to confirm informed consent to participate . Time series and correlation analysis have been adopted as research protocol utilizing Google community mobility report (CMR) data and the national daily new cases reported by the Ministry of Health (Abdullah, 2021). Other influential work includes (Camba et. al., 2020), (Petersen et. al., 2022). However, more comprehensive research is needed to better understand the factors contributing to these changes and the potential long-term implications of the pandemic on human mobility.</p>
<p>This study aims to assess the effect of COVID-19 on U.S. mobility using Google Community Mobility Reports as a data source. These reports provide daily, anonymized, and aggregated data on movement trends across six categories: retail and recreation, grocery and pharmacy, parks, transit stations, workplaces, and residential areas. By analyzing this data, we seek to provide a comprehensive understanding of the pandemic’s impact on different aspects of mobility and identify factors that contribute to these changes. The findings from this study can inform policymaking and provide valuable insights for future research on the long-term consequences of the pandemic on human mobility.</p>
</section>
<section id="data-source">
<h2>Data Source<a class="headerlink" href="#data-source" title="Permalink to this heading">#</a></h2>
<section id="descriptive-analysis">
<h3>Descriptive Analysis<a class="headerlink" href="#descriptive-analysis" title="Permalink to this heading">#</a></h3>
<p>Google Community Mobility Reports provide daily data on mobility trends across six categories: retail and recreation, grocery and pharmacy, parks, transit stations, workplaces, and residential areas. The data is collected from users who have opted-in to location history tracking on their Google accounts.</p>
<p>We selected data from January 2020 to December 2022, representing the pre-pandemic and pandemic periods. The data was cleaned and preprocessed to address missing values and inconsistencies. We aggregated the data at the state level to facilitate regional analysis. The following sections provide the descriptive exploratory data analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gcmda.utils</span> <span class="kn">import</span> <span class="n">mobility_trends_by_date</span>
<span class="kn">from</span> <span class="nn">gcmda.utils</span> <span class="kn">import</span> <span class="n">mobility_trends_by_year_month</span>
<span class="kn">from</span> <span class="nn">gcmda.utils</span> <span class="kn">import</span> <span class="n">mobility_trends_by_category</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Load the data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">US_2020</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/2020_US_Region_Mobility_Report.csv&#39;</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">US_2021</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/2021_US_Region_Mobility_Report.csv&#39;</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">US_2022</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/2022_US_Region_Mobility_Report.csv&#39;</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Concatenate three dataframes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">US_Mobility</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">US_2020</span><span class="p">,</span> <span class="n">US_2021</span><span class="p">,</span> <span class="n">US_2022</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">US_Mobility</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>country_region_code</th>
      <th>country_region</th>
      <th>sub_region_1</th>
      <th>sub_region_2</th>
      <th>metro_area</th>
      <th>iso_3166_2_code</th>
      <th>census_fips_code</th>
      <th>place_id</th>
      <th>date</th>
      <th>retail_and_recreation_percent_change_from_baseline</th>
      <th>grocery_and_pharmacy_percent_change_from_baseline</th>
      <th>parks_percent_change_from_baseline</th>
      <th>transit_stations_percent_change_from_baseline</th>
      <th>workplaces_percent_change_from_baseline</th>
      <th>residential_percent_change_from_baseline</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1676636</th>
      <td>US</td>
      <td>United States</td>
      <td>Virginia</td>
      <td>Grayson County</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>51077.0</td>
      <td>ChIJD-JjiS3dUYgRz7gs9ae37CA</td>
      <td>2021-07-30</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-17.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1397550</th>
      <td>US</td>
      <td>United States</td>
      <td>North Carolina</td>
      <td>Halifax County</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>37083.0</td>
      <td>ChIJ78ZlU81urokRxogteWGBj0w</td>
      <td>2021-12-19</td>
      <td>5.0</td>
      <td>-2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-23.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>1592290</th>
      <td>US</td>
      <td>United States</td>
      <td>Texas</td>
      <td>Deaf Smith County</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>48117.0</td>
      <td>ChIJN3ODW3e7A4cRfTRhqEpDufM</td>
      <td>2021-06-02</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-26.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>695227</th>
      <td>US</td>
      <td>United States</td>
      <td>Texas</td>
      <td>Polk County</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>48373.0</td>
      <td>ChIJ0bDiw-jyOIYRPrqcrZnzyQc</td>
      <td>2020-05-28</td>
      <td>7.0</td>
      <td>20.0</td>
      <td>NaN</td>
      <td>-15.0</td>
      <td>-20.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>389978</th>
      <td>US</td>
      <td>United States</td>
      <td>Mississippi</td>
      <td>Wayne County</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>28153.0</td>
      <td>ChIJeduQ4weYnIgR9ztNZM26NnY</td>
      <td>2020-05-13</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-25.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">US_Mobility</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 2511994 entries, 0 to 2511993
Data columns (total 15 columns):
 #   Column                                              Dtype  
---  ------                                              -----  
 0   country_region_code                                 object 
 1   country_region                                      object 
 2   sub_region_1                                        object 
 3   sub_region_2                                        object 
 4   metro_area                                          float64
 5   iso_3166_2_code                                     object 
 6   census_fips_code                                    float64
 7   place_id                                            object 
 8   date                                                object 
 9   retail_and_recreation_percent_change_from_baseline  float64
 10  grocery_and_pharmacy_percent_change_from_baseline   float64
 11  parks_percent_change_from_baseline                  float64
 12  transit_stations_percent_change_from_baseline       float64
 13  workplaces_percent_change_from_baseline             float64
 14  residential_percent_change_from_baseline            float64
dtypes: float64(8), object(7)
memory usage: 287.5+ MB
</pre></div>
</div>
</div>
</div>
<p>rename columns and select relevant columns</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># rename columns</span>
<span class="n">US_Mobility</span> <span class="o">=</span> <span class="n">US_Mobility</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sub_region_1&#39;</span><span class="p">:</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;sub_region_2&#39;</span><span class="p">:</span> <span class="s1">&#39;county&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;retail_and_recreation_percent_change_from_baseline&#39;</span><span class="p">:</span> <span class="s1">&#39;retail_and_recreation&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;grocery_and_pharmacy_percent_change_from_baseline&#39;</span><span class="p">:</span><span class="s1">&#39;grocery_and_pharmacy&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;parks_percent_change_from_baseline&#39;</span><span class="p">:</span><span class="s1">&#39;parks&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;transit_stations_percent_change_from_baseline&#39;</span><span class="p">:</span><span class="s1">&#39;transit_stations&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;workplaces_percent_change_from_baseline&#39;</span><span class="p">:</span><span class="s1">&#39;workplaces&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;residential_percent_change_from_baseline&#39;</span><span class="p">:</span><span class="s1">&#39;residential&#39;</span><span class="p">}</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">,</span>
           <span class="s1">&#39;county&#39;</span><span class="p">,</span>
           <span class="s1">&#39;date&#39;</span><span class="p">,</span>
           <span class="s1">&#39;retail_and_recreation&#39;</span><span class="p">,</span> 
           <span class="s1">&#39;grocery_and_pharmacy&#39;</span><span class="p">,</span> 
           <span class="s1">&#39;parks&#39;</span><span class="p">,</span>
           <span class="s1">&#39;transit_stations&#39;</span><span class="p">,</span> 
           <span class="s1">&#39;workplaces&#39;</span><span class="p">,</span> 
           <span class="s1">&#39;residential&#39;</span><span class="p">]</span>
<span class="n">US_Mobility</span> <span class="o">=</span> <span class="n">US_Mobility</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span>

<span class="n">US_Mobility</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>county</th>
      <th>date</th>
      <th>retail_and_recreation</th>
      <th>grocery_and_pharmacy</th>
      <th>parks</th>
      <th>transit_stations</th>
      <th>workplaces</th>
      <th>residential</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>480870</th>
      <td>New York</td>
      <td>Schuyler County</td>
      <td>2020-02-27</td>
      <td>12.0</td>
      <td>-9.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>794944</th>
      <td>Wisconsin</td>
      <td>Lincoln County</td>
      <td>2020-03-28</td>
      <td>-54.0</td>
      <td>-31.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-28.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2246499</th>
      <td>Ohio</td>
      <td>Athens County</td>
      <td>2022-05-09</td>
      <td>-4.0</td>
      <td>-2.0</td>
      <td>NaN</td>
      <td>-43.0</td>
      <td>-23.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>239645</th>
      <td>Iowa</td>
      <td>Webster County</td>
      <td>2020-10-08</td>
      <td>2.0</td>
      <td>47.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-15.0</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2331118</th>
      <td>South Carolina</td>
      <td>Williamsburg County</td>
      <td>2022-09-01</td>
      <td>NaN</td>
      <td>5.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>-15.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">US_Mobility</span><span class="p">[</span><span class="s1">&#39;year_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">US_Mobility</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">US_Mobility</span><span class="p">[</span><span class="s1">&#39;year_month&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0          2020-02
1          2020-02
2          2020-02
3          2020-02
4          2020-02
            ...   
2511989    2022-10
2511990    2022-10
2511991    2022-10
2511992    2022-10
2511993    2022-10
Name: year_month, Length: 2511994, dtype: object
</pre></div>
</div>
</div>
</div>
</section>
<section id="correlation-analysis">
<h3>Correlation Analysis<a class="headerlink" href="#correlation-analysis" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">US_Mobility</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">corr_matrix</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>retail_and_recreation</th>
      <th>grocery_and_pharmacy</th>
      <th>parks</th>
      <th>transit_stations</th>
      <th>workplaces</th>
      <th>residential</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>retail_and_recreation</th>
      <td>1.000000</td>
      <td>0.684696</td>
      <td>0.408976</td>
      <td>0.551236</td>
      <td>0.484599</td>
      <td>-0.589351</td>
    </tr>
    <tr>
      <th>grocery_and_pharmacy</th>
      <td>0.684696</td>
      <td>1.000000</td>
      <td>0.394135</td>
      <td>0.411115</td>
      <td>0.324189</td>
      <td>-0.406658</td>
    </tr>
    <tr>
      <th>parks</th>
      <td>0.408976</td>
      <td>0.394135</td>
      <td>1.000000</td>
      <td>0.264516</td>
      <td>0.130495</td>
      <td>-0.309295</td>
    </tr>
    <tr>
      <th>transit_stations</th>
      <td>0.551236</td>
      <td>0.411115</td>
      <td>0.264516</td>
      <td>1.000000</td>
      <td>0.388367</td>
      <td>-0.452145</td>
    </tr>
    <tr>
      <th>workplaces</th>
      <td>0.484599</td>
      <td>0.324189</td>
      <td>0.130495</td>
      <td>0.388367</td>
      <td>1.000000</td>
      <td>-0.773892</td>
    </tr>
    <tr>
      <th>residential</th>
      <td>-0.589351</td>
      <td>-0.406658</td>
      <td>-0.309295</td>
      <td>-0.452145</td>
      <td>-0.773892</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e2969a26c5f48d25f80f9c54de818c14b0bb5daa19904f162f2f2e5000ae7924.png" src="_images/e2969a26c5f48d25f80f9c54de818c14b0bb5daa19904f162f2f2e5000ae7924.png" />
</div>
</div>
</section>
</section>
<section id="spatiotemporal-trends-analysis">
<h2>Spatiotemporal Trends Analysis<a class="headerlink" href="#spatiotemporal-trends-analysis" title="Permalink to this heading">#</a></h2>
<section id="temporal-trends-by-date">
<h3>Temporal Trends by Date<a class="headerlink" href="#temporal-trends-by-date" title="Permalink to this heading">#</a></h3>
<section id="retail-and-recreation">
<h4>Retail and Recreation<a class="headerlink" href="#retail-and-recreation" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_date</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;retail_and_recreation&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;retail and recreation&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b9987cd050578cc289954e121b58101242d8bb342e77bdbbfe27f9c12cf853d6.png" src="_images/b9987cd050578cc289954e121b58101242d8bb342e77bdbbfe27f9c12cf853d6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_year_month</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;retail_and_recreation&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;retail and recreation&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6d318300fc2ba0ffdf8a9d175c81da6f8b7e1dfbccaedb67b06079719170b5a8.png" src="_images/6d318300fc2ba0ffdf8a9d175c81da6f8b7e1dfbccaedb67b06079719170b5a8.png" />
</div>
</div>
</section>
<section id="parks">
<h4>Parks<a class="headerlink" href="#parks" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_date</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;parks&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;parks&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7160ed23e1b505809d3ba895af26fcd197eff7790762f391943c3e73433afef2.png" src="_images/7160ed23e1b505809d3ba895af26fcd197eff7790762f391943c3e73433afef2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_year_month</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;parks&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;parks&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7452f7b1db90c027fb145c2d2e56d66e3383bd0748f690d5c0b7e0d8f445381c.png" src="_images/7452f7b1db90c027fb145c2d2e56d66e3383bd0748f690d5c0b7e0d8f445381c.png" />
</div>
</div>
</section>
<section id="transit-stations">
<h4>Transit Stations<a class="headerlink" href="#transit-stations" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_date</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;transit_stations&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;transit stations&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/460eb6299b0c3c9daa97865732ffe13f7d4197785b673a13dff50a5adbce72bb.png" src="_images/460eb6299b0c3c9daa97865732ffe13f7d4197785b673a13dff50a5adbce72bb.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_year_month</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;transit_stations&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;transit stations&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/013dad3daf356ac0deafe9de381c677e96bda1146c5d95f6c884d7f694b3299c.png" src="_images/013dad3daf356ac0deafe9de381c677e96bda1146c5d95f6c884d7f694b3299c.png" />
</div>
</div>
</section>
<section id="grocery-and-pharmacy">
<h4>Grocery and Pharmacy<a class="headerlink" href="#grocery-and-pharmacy" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_date</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;grocery_and_pharmacy&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;grocery and pharmacy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d39f85c87d712603d50ae2056016a89f926533f94acdf40baab1a42be9196a7f.png" src="_images/d39f85c87d712603d50ae2056016a89f926533f94acdf40baab1a42be9196a7f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_year_month</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;grocery_and_pharmacy&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;grocery and pharmacy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b33ba8146236bb9514b7dfd529dc903fabc91fc4092c4e83cc8297b302405822.png" src="_images/b33ba8146236bb9514b7dfd529dc903fabc91fc4092c4e83cc8297b302405822.png" />
</div>
</div>
</section>
<section id="residential">
<h4>Residential<a class="headerlink" href="#residential" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_date</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;residential&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;residential&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d2344c3e0a1313000599fbf511c794f6e549f029bbdad70ed05d4930617d6d41.png" src="_images/d2344c3e0a1313000599fbf511c794f6e549f029bbdad70ed05d4930617d6d41.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_year_month</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;residential&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;residential&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ec8a51d55472ced610e0d66d80e7ed7b6094ecbc422619e05cf49fad3299569c.png" src="_images/ec8a51d55472ced610e0d66d80e7ed7b6094ecbc422619e05cf49fad3299569c.png" />
</div>
</div>
</section>
<section id="workplaces">
<h4>Workplaces<a class="headerlink" href="#workplaces" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_date</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;workplaces&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;workplaces&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/46c751e2feeec0733e90781ea8385443c13c469698b993597afa96e49eb5b39a.png" src="_images/46c751e2feeec0733e90781ea8385443c13c469698b993597afa96e49eb5b39a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_year_month</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;workplaces&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;workplaces&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e308c9d64cf3cbb705d382f858893a3056723b9d90ad49f4691eba3a54548ec7.png" src="_images/e308c9d64cf3cbb705d382f858893a3056723b9d90ad49f4691eba3a54548ec7.png" />
</div>
</div>
<p>Our analysis revealed significant decreases in mobility across all categories during the pandemic, with the most substantial reductions observed in retail and recreation, transit stations, and workplaces. The residential category experienced increased mobility, reflecting the shift to remote work and stay-at-home orders.</p>
</section>
</section>
<section id="spatial-trends-by-state">
<h3>Spatial Trends by State<a class="headerlink" href="#spatial-trends-by-state" title="Permalink to this heading">#</a></h3>
<section id="id1">
<h4>Retail and Recreation<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_category</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;retail_and_recreation&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Parks&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fe68a5a242b3de29ddd478cd8f987134cbe7e394cc295713121c3c53bb7b41f1.png" src="_images/fe68a5a242b3de29ddd478cd8f987134cbe7e394cc295713121c3c53bb7b41f1.png" />
</div>
</div>
</section>
<section id="id2">
<h4>Parks<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_category</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;parks&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Parks&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b0b37fe0744355b3e7903823e39779b0178a84b7111bd16bf18a3c6a2d96b108.png" src="_images/b0b37fe0744355b3e7903823e39779b0178a84b7111bd16bf18a3c6a2d96b108.png" />
</div>
</div>
</section>
<section id="id3">
<h4>Transit Stations<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_category</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;transit_stations&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Transit Stations&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f338d30e5af8d0ccad896fa501d00ffaef160078748c9cf75d6d42ffe2725621.png" src="_images/f338d30e5af8d0ccad896fa501d00ffaef160078748c9cf75d6d42ffe2725621.png" />
</div>
</div>
</section>
<section id="id4">
<h4>Grocery and Pharmacy<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_category</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;grocery_and_pharmacy&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Grocery and Pharmacy&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dce845ef4453be1f5ecccb7fc19b7b48386bda361d7f33cd800acdd8c12cafcd.png" src="_images/dce845ef4453be1f5ecccb7fc19b7b48386bda361d7f33cd800acdd8c12cafcd.png" />
</div>
</div>
</section>
<section id="id5">
<h4>Residential<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_category</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;residential&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Residential&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9b5d689f632095f6ba5fbe517c9e925597bfade49c468fbbd54a7e2c99e0f68f.png" src="_images/9b5d689f632095f6ba5fbe517c9e925597bfade49c468fbbd54a7e2c99e0f68f.png" />
</div>
</div>
</section>
<section id="id6">
<h4>Workplaces<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_category</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">US_Mobility</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;workplaces&#39;</span><span class="p">,</span> <span class="n">plot_title</span><span class="o">=</span><span class="s1">&#39;Workplaces&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3b1fe660b66a2c058fb7802393d23756b83a4a8c180e5a5dff8bc4bf2ee1505e.png" src="_images/3b1fe660b66a2c058fb7802393d23756b83a4a8c180e5a5dff8bc4bf2ee1505e.png" />
</div>
</div>
</section>
</section>
</section>
<section id="dependency-analysis">
<h2>Dependency Analysis<a class="headerlink" href="#dependency-analysis" title="Permalink to this heading">#</a></h2>
<section id="analyze-covid-cases-by-state">
<h3>Analyze covid cases by state<a class="headerlink" href="#analyze-covid-cases-by-state" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">covid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/covid.csv&quot;</span><span class="p">)</span>
<span class="n">covid</span> <span class="o">=</span> <span class="n">covid</span><span class="p">[</span><span class="n">covid</span><span class="p">[</span><span class="s2">&quot;Location&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;United States&quot;</span><span class="p">]</span>
<span class="n">covid</span><span class="p">[</span><span class="s2">&quot;COVID_rate (%)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="n">covid</span><span class="p">[</span><span class="s2">&quot;Oct_2020_Cases&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">covid</span><span class="p">[</span><span class="s2">&quot;Total Population&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">covid_sorted</span> <span class="o">=</span> <span class="n">covid</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;COVID_rate (%)&quot;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">covid_sorted</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">covid_sorted</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Location&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;COVID_rate (%)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;covid cases by state&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">70</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b3e816536dd6fc82cf9276d6f7c0f3ed232d27784641c23270bd6f6adcf8317d.png" src="_images/b3e816536dd6fc82cf9276d6f7c0f3ed232d27784641c23270bd6f6adcf8317d.png" />
</div>
</div>
</section>
<section id="how-different-gathering-bans-affect-covid-affection-rate">
<h3>How different gathering bans affect covid affection rate?<a class="headerlink" href="#how-different-gathering-bans-affect-covid-affection-rate" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">covid</span><span class="p">[</span><span class="s2">&quot;Large Gatherings Ban&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
<span class="n">covid_gathering_bans</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">covid</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Large Gatherings Ban&quot;</span><span class="p">)[</span><span class="s2">&quot;COVID_rate (%)&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
                        <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;COVID_rate (%)&quot;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">))</span>
<span class="n">covid_gathering_bans</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="c1">#sns.barplot(data=covid_sorted, x=&quot;Location&quot;, y=&quot;COVID_rate (%)&quot;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">70</span><span class="p">);</span>
<span class="n">sns</span><span class="o">.</span><span class="n">violinplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">covid</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Large Gatherings Ban&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;COVID_rate (%)&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">covid_gathering_bans</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="c1">#sns.lineplot(</span>
<span class="c1">#    x=covid_gathering_bans.index,</span>
<span class="c1">#    y=covid_gathering_bans[&quot;COVID_rate (%)&quot;],</span>
<span class="c1">#    style=&quot;event&quot;</span>
<span class="c1">#)</span>
<span class="n">covid_gathering_bans</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;No Limit&#39;, &#39;&gt;50 Prohibited&#39;, &#39;All Gatherings Prohibited&#39;,
       &#39;&gt;10 Prohibited&#39;, &#39;&gt;25 Prohibited&#39;], dtype=object)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COVID_rate (%)</th>
    </tr>
    <tr>
      <th>Large Gatherings Ban</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>&gt;50 Prohibited</th>
      <td>0.923554</td>
    </tr>
    <tr>
      <th>&gt;25 Prohibited</th>
      <td>0.919531</td>
    </tr>
    <tr>
      <th>No Limit</th>
      <td>0.906760</td>
    </tr>
    <tr>
      <th>&gt;10 Prohibited</th>
      <td>0.534330</td>
    </tr>
    <tr>
      <th>All Gatherings Prohibited</th>
      <td>0.416476</td>
    </tr>
  </tbody>
</table>
</div></div><img alt="_images/4611bc29ba0ad695f9d51365572403d1430a8e082c1caa43d642b901c2834ec0.png" src="_images/4611bc29ba0ad695f9d51365572403d1430a8e082c1caa43d642b901c2834ec0.png" />
</div>
</div>
<p>we could see that gathering bans are useful in preventing the spread of COVID</p>
</section>
<section id="regression-covid-infection-rate-on-other-variables">
<h3>regression covid infection rate on other variables<a class="headerlink" href="#regression-covid-infection-rate-on-other-variables" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;COVID_rate (%)&quot;</span><span class="p">,</span> <span class="s2">&quot;Depression.2020&quot;</span><span class="p">,</span> <span class="s2">&quot;Employer&quot;</span><span class="p">,</span> <span class="s2">&quot;Medicaid&quot;</span><span class="p">,</span> <span class="s2">&quot;Medicare&quot;</span><span class="p">,</span> <span class="s2">&quot;Uninsured&quot;</span><span class="p">,</span> <span class="s2">&quot;Large Gatherings Ban&quot;</span><span class="p">,</span> <span class="s2">&quot;Restaurant Limits&quot;</span><span class="p">]</span>
<span class="n">covid1</span> <span class="o">=</span> <span class="n">covid</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">numerical</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="n">covid1</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">covid1</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="s1">&#39;float64&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">covid1</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">covid1</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">==</span> <span class="s1">&#39;int64&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">categorical</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="n">covid1</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">covid1</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="s1">&#39;float64&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">covid1</span><span class="o">.</span><span class="n">dtypes</span><span class="p">[</span><span class="n">covid1</span><span class="o">.</span><span class="n">dtypes</span> <span class="o">!=</span> <span class="s1">&#39;int64&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
<span class="n">categorical</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Large Gatherings Ban&#39;, &#39;Restaurant Limits&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">ohe</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="n">enc</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">()</span>
    <span class="n">enc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">])</span>
    <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">enc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">column</span><span class="p">])</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
    <span class="n">encoded_data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()</span>
    <span class="n">encoded_data</span> <span class="o">=</span> <span class="n">encoded_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">encoded_data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ohe_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">covid1</span><span class="p">[</span><span class="n">numerical</span><span class="p">],</span> <span class="n">ohe</span><span class="p">(</span><span class="n">covid1</span><span class="p">[</span><span class="n">categorical</span><span class="p">],</span> <span class="n">categorical</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ohe_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>COVID_rate (%)</th>
      <th>Depression.2020</th>
      <th>Employer</th>
      <th>Medicaid</th>
      <th>Medicare</th>
      <th>Uninsured</th>
      <th>Large Gatherings Ban_&gt;10 Prohibited</th>
      <th>Large Gatherings Ban_&gt;25 Prohibited</th>
      <th>Large Gatherings Ban_&gt;50 Prohibited</th>
      <th>Large Gatherings Ban_All Gatherings Prohibited</th>
      <th>Large Gatherings Ban_No Limit</th>
      <th>Restaurant Limits_-</th>
      <th>Restaurant Limits_New Service Limits</th>
      <th>Restaurant Limits_Newly Closed to Indoor Dining</th>
      <th>Restaurant Limits_Reopened to Dine-in Service</th>
      <th>Restaurant Limits_Reopened to Dine-in Service with Capacity Limits</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.745250</td>
      <td>33.8</td>
      <td>0.469639</td>
      <td>0.195321</td>
      <td>0.158831</td>
      <td>0.101714</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.001716</td>
      <td>27.1</td>
      <td>0.481289</td>
      <td>0.213177</td>
      <td>0.094280</td>
      <td>0.120369</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.367290</td>
      <td>27.2</td>
      <td>0.444624</td>
      <td>0.223905</td>
      <td>0.155921</td>
      <td>0.106147</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.906918</td>
      <td>28.3</td>
      <td>0.418750</td>
      <td>0.272687</td>
      <td>0.156044</td>
      <td>0.082839</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.276735</td>
      <td>29.7</td>
      <td>0.473513</td>
      <td>0.263108</td>
      <td>0.109437</td>
      <td>0.071597</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">ohe_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;COVID_rate (%)&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">ohe_df</span><span class="p">[</span><span class="s2">&quot;COVID_rate (%)&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;model intercept :&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;model coefficients : &#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training Accuracy: &#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>model intercept : 3.8192792490168204
model coefficients :  [-0.01522958 -2.86343683 -3.30809215 -3.93673412  2.1371601  -0.03378686
  0.4202171  -0.38477096 -0.10947185  0.10781256  1.2697461  -0.22060498
 -0.1507367  -0.42249257 -0.47591184]
Training Accuracy:  0.722562928021383
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">test_predictions</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4365241953146723
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="social-productivity-related-mobility-trends">
<h2>Social Productivity-Related Mobility Trends<a class="headerlink" href="#social-productivity-related-mobility-trends" title="Permalink to this heading">#</a></h2>
<p>Increased mobility as people spent more time at home due to remote work and stay-at-home orders.</p>
<p>We assumed that there will be relation between residential and workplaces categories since if people work at home, the residential mobility will increase and the workplaces mobility will decrease. Calculating the correlation coefficient between residential category and workplaces category, the value was -0.83 which is quite high. This means that as the residential mobility increases, the workplaces mobility decreases or as the residential mobility decreases, the workplaces mobility increases with quite high rate. This makes sense with our assumption of the relation between residential and workplaces mobility trend.</p>
<p>In this section we inspect the correlation between the social productivity-related mobility drop with the viruses transmission situation estimated by the number of cases, using the workplace and residential mobility data as instance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">US_2020</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">US_2022</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2020-02-15
2022-10-15
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cases</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/US-States.csv&quot;</span><span class="p">)</span>
<span class="n">cases</span> <span class="o">=</span> <span class="n">cases</span><span class="p">[(</span><span class="n">cases</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s1">&#39;2020-02-15&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cases</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="s1">&#39;2022-10-15&#39;</span><span class="p">)]</span>
<span class="n">cases</span><span class="p">[</span><span class="s1">&#39;year_month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cases</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cases</span><span class="p">[</span><span class="s1">&#39;year_month&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>115      2020-02
116      2020-02
117      2020-02
118      2020-02
119      2020-02
          ...   
53033    2022-10
53034    2022-10
53035    2022-10
53036    2022-10
53037    2022-10
Name: year_month, Length: 52923, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">cases</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;year_month&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;cases&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">45</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/24c69d1b45861443ef2c016014fdae75398c822a11a75c1583e228ec34df6d69.png" src="_images/24c69d1b45861443ef2c016014fdae75398c822a11a75c1583e228ec34df6d69.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid_case</span> <span class="o">=</span> <span class="n">cases</span><span class="p">[</span><span class="n">cases</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">US_Mobility</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mobility_trends_by_category</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">valid_case</span><span class="p">,</span> <span class="n">category</span> <span class="o">=</span> <span class="s1">&#39;cases&#39;</span><span class="p">,</span> <span class="n">plot_title</span> <span class="o">=</span> <span class="s1">&#39;cases&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f950511341b0f9a32da0c55dfd1eb0206fe4b18fde0b8fdcf08b832e8c410110.png" src="_images/f950511341b0f9a32da0c55dfd1eb0206fe4b18fde0b8fdcf08b832e8c410110.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">US_Mobility</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>county</th>
      <th>date</th>
      <th>retail_and_recreation</th>
      <th>grocery_and_pharmacy</th>
      <th>parks</th>
      <th>transit_stations</th>
      <th>workplaces</th>
      <th>residential</th>
      <th>year_month</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2020-02-15</td>
      <td>6.0</td>
      <td>2.0</td>
      <td>15.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>-1.0</td>
      <td>2020-02</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2020-02-16</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>16.0</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>-1.0</td>
      <td>2020-02</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2020-02-17</td>
      <td>6.0</td>
      <td>0.0</td>
      <td>28.0</td>
      <td>-9.0</td>
      <td>-24.0</td>
      <td>5.0</td>
      <td>2020-02</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2020-02-18</td>
      <td>0.0</td>
      <td>-1.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2020-02</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>2020-02-19</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>8.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2020-02</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">US_Mobility_noNAs</span> <span class="o">=</span> <span class="n">US_Mobility</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">corr_res_work</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">US_Mobility_noNAs</span><span class="p">[</span><span class="s1">&#39;residential&#39;</span><span class="p">],</span> <span class="n">US_Mobility_noNAs</span><span class="p">[</span><span class="s1">&#39;workplaces&#39;</span><span class="p">])</span>
<span class="n">corr_res_work</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.        , -0.82579813],
       [-0.82579813,  1.        ]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_res_work</span><span class="p">,</span> <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/74babc873185784790f01b9d905102366415c07a271200129bda6b1453b5d098.png" src="_images/74babc873185784790f01b9d905102366415c07a271200129bda6b1453b5d098.png" />
</div>
</div>
</section>
<section id="mechanism-analysis-based-on-demand-modeling">
<h2>Mechanism Analysis based on Demand Modeling<a class="headerlink" href="#mechanism-analysis-based-on-demand-modeling" title="Permalink to this heading">#</a></h2>
<p>In order to understand the mechanism of epidemic spread effect on the community mobility change, we modelled the demand-service relationship by proposing the Double Quadratic Queue (DQQ) model.</p>
<p>By adopting the fluid queue derivation process, the model considers the two distinct stages and differentiates itself from a typical single-stage fluid queue model. The fluid queue modeling approach is a method used to analyze and model the behavior of queues in a dynamic setting, taking into account varying arrival and discharge rates. Newell’s approach combines Taylor expansion, calculus, and geometric representation to derive an algebraic expression for the queue length at any given time. The DQQ model incorporates both geometric representation and algebraic expression. This fluid queue process helps visualize the relationships between arrival and discharge rates, queue length, and the passage of time. The ultimate goal of the subsequent derivation process is to obtain an algebraic expression for the queue length or cumulative change, which can be employed to study the queue’s or system’s behavior analytically.</p>
<p><img alt="" src="_images/dqq-curves.png" /></p>
<p>The mathematical expression of the proposed DQQ model is provided in the <a class="reference external" href="https://github.com/UCB-stat-159-s23/project-Group24/blob/main/Appendix%20A%20-%20DQQ.pdf">Appendix A</a>. Typically, the following parameters are observable directly from time series datasets:
<span class="math notranslate nohighlight">\(t_0\)</span>: the time when epidemic spread starts,
<span class="math notranslate nohighlight">\(t_1\)</span>: the time when reach the lowest net flow rate,
<span class="math notranslate nohighlight">\(t_2\)</span>: the time when the net flow rate become 0 first time after <span class="math notranslate nohighlight">\(t_0\)</span>, i.e. when the mobility reach the lowest point and start to recover,
<span class="math notranslate nohighlight">\(t_3\)</span>: the time when the net flow rate reach the highest point, i.e. when the mobility was recovering at the highest speed,
<span class="math notranslate nohighlight">\(t_4\)</span>: the time when the net flow rate reach and keep at 0, i.e. when the mobility reach the summit equilibrium after epidemic,
<span class="math notranslate nohighlight">\(Q_max\)</span>: the change in mobility metrics at <span class="math notranslate nohighlight">\(t_2\)</span>, i.e. the worst damage caused by epidemic,</p>
<p>In the DQQ model applied in this project, we assume the net flow rate, <span class="math notranslate nohighlight">\(π(t)\)</span>, can be represented as double quadratic forms, as shown in the Figure below, which has three intersection points, <span class="math notranslate nohighlight">\(t_0\)</span>, <span class="math notranslate nohighlight">\(t_2\)</span>, and <span class="math notranslate nohighlight">\(t_4\)</span>, with the horizontal axis.</p>
<p>Function <code class="docutils literal notranslate"><span class="pre">util.find_ts</span></code> provide the process we applied to capture the critical time points and the worst damage caused by epidemic for each state described by the proposed DQQ model. The following codes show the data process and visualization of the DQQ model analysis results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">18</span><span class="p">})</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">MultipleLocator</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gcmda.utils</span> <span class="kn">import</span> <span class="n">find_ts</span>
<span class="n">pd</span><span class="o">.</span><span class="n">reset_option</span><span class="p">(</span><span class="s2">&quot;mode.chained_assignment&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">fig_path</span> <span class="o">=</span> <span class="s1">&#39;figures/dqq_outputs&#39;</span>
<span class="n">out_put_path</span> <span class="o">=</span> <span class="s1">&#39;output&#39;</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/2020_US_Region_Mobility_Report.csv&#39;</span><span class="p">,</span>
                 <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sub_region_1&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;transit_stations_percent_change_from_baseline&#39;</span><span class="p">])</span>

<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;change_rate&#39;</span><span class="p">]</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;change_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="n">df_full</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>

<span class="n">state_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">df_full</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;change_rate&#39;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>

<span class="n">US_avg</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">date_pt</span><span class="p">,</span> <span class="n">date_df</span> <span class="ow">in</span> <span class="n">df_full</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">):</span>
    <span class="n">US_avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date_df</span><span class="p">[</span><span class="s1">&#39;change_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

<span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;US&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">US_avg</span>
<span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;US_rolling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;US&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">out_put</span> <span class="o">=</span> <span class="p">{</span>

    <span class="s1">&#39;state&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;t0&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;rate_t0&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;day_index_t0&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;t1&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;rate_t1&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;day_index_t1&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;t2&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;rate_t2&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;day_index_t2&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;t3&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;rate_t3&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;day_index_t3&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;t4&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;rate_t4&#39;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s1">&#39;day_index_t4&#39;</span><span class="p">:</span> <span class="p">[],</span>

<span class="p">}</span>

<span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">state_date</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<span class="c1"># for state in [&#39;US&#39;, &#39;Arizona&#39;]:</span>
    <span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_rolling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">state_date</span><span class="p">)))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="s1">&#39;US&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_rolling&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;US_rolling&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;US&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">y_lim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">6</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">6</span><span class="p">)]</span>
    <span class="n">text_y</span> <span class="o">=</span> <span class="n">y_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>

    <span class="n">x_lim</span> <span class="o">=</span> <span class="p">[</span><span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>



    <span class="n">ts</span> <span class="o">=</span> <span class="n">find_ts</span><span class="p">(</span><span class="n">state_date</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_rolling&#39;</span><span class="p">,</span> <span class="s1">&#39;index_num&#39;</span><span class="p">]],</span> <span class="n">state</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t0&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t1&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t2&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t3&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t3&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t4&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t4&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>


    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="n">text_y</span><span class="p">),</span>
                 <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;t0:</span><span class="si">{</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;t0&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                 <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t0&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span><span class="p">),</span>
                 <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Q(t0)=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;rate_t0&quot;</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>
                 <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">text_y</span><span class="p">),</span>
                 <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;t1:</span><span class="si">{</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;t1&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                 <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t1&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.6</span><span class="p">),</span>
                 <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Q(t1)=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;rate_t1&quot;</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>
                 <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">text_y</span><span class="p">),</span>
                 <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;t2:</span><span class="si">{</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;t2&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                 <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t2&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.6</span><span class="p">),</span>
                 <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Q(t2)=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;rate_t2&quot;</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>
                 <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t3&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">text_y</span><span class="p">),</span>
                 <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;t3:</span><span class="si">{</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;t3&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                 <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t3&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span><span class="p">),</span>
                 <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Q(t3)=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;rate_t3&quot;</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>
                 <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t4&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">2.2</span><span class="p">,</span> <span class="n">text_y</span><span class="p">),</span>
                 <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;t4:</span><span class="si">{</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;t4&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                 <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t4&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span><span class="p">),</span>
                 <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Q(t4)=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;rate_t4&quot;</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>
                 <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>

    <span class="n">x_major_locator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">x_major_locator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>


    <span class="c1"># dashline for anotations</span>
    <span class="n">dashlline_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span>
                   <span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span>
                   <span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span>
                   <span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t3&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span>
                   <span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t4&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]]</span>
    <span class="n">dashlline_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t0&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t1&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t2&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t3&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t4&#39;</span><span class="p">]]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">dashlline_x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dashlline_x</span><span class="p">))</span> <span class="o">*</span> <span class="n">y_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dashlline_y</span><span class="p">,</span>
              <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">hlines</span><span class="p">(</span><span class="n">dashlline_y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dashlline_x</span><span class="p">)),</span> <span class="n">dashlline_x</span><span class="p">,</span>
              <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Transit Stations Percent Change from Baseline of 2020: </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Change Rate (%)&#39;</span><span class="p">)</span>
    <span class="c1"># plt.show()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fig_path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="c1"># print(f&#39;Plotting {state}&#39;)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="s1">&#39;US&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_rolling&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;US_rolling&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;US&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">x_lim</span><span class="p">)</span>
    <span class="n">x_major_locator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>




    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">x_major_locator</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Transit Stations Percent Change from Baseline of 2020: </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Change Rate (%)&#39;</span><span class="p">)</span>
    <span class="c1"># plt.show()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fig_path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_only_curve.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="c1"># print(f&#39;Plotting {state}&#39;)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">dashlline_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span>
                   <span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span>
                   <span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span>
                   <span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t3&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span>
                   <span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t4&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]]</span>

    <span class="n">out_put</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="s1">&#39;t1&#39;</span><span class="p">,</span> <span class="s1">&#39;t2&#39;</span><span class="p">,</span> <span class="s1">&#39;t3&#39;</span><span class="p">,</span> <span class="s1">&#39;t4&#39;</span><span class="p">]:</span>
        <span class="n">out_put</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
        <span class="n">out_put</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;rate_</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;rate_</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">])</span>
        <span class="n">out_put</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;day_index_</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="n">t</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">])</span>

<span class="n">out_put_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">out_put</span><span class="p">)</span>
<span class="n">out_put_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">out_put_path</span><span class="si">}</span><span class="s1">/dqq_transit_ts.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The full output figure set for each states could be find in <code class="docutils literal notranslate"><span class="pre">figures/dqq_outputs</span></code>. Here are some examples:</p>
<p><img alt="" src="_images/US.png" /></p>
<p>The figure above indicates that the worst mobility drop (-35.51%) in US transit system , <span class="math notranslate nohighlight">\(t_2\)</span>, was reached in the middle April. Since then the recovery process start and reached the summited equilibrium (-6.52%) in the middle of June. The second wave of COVID-19 hit US in the interface of July and August, which caused the mobility to further drop and lead to a worse equilibrium later in November.</p>
<p>Let’s compare the pattern of transit with other catagories:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">classes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;retail_and_recreation_percent_change_from_baseline&#39;</span><span class="p">,</span>
           <span class="s1">&#39;grocery_and_pharmacy_percent_change_from_baseline&#39;</span><span class="p">,</span>
           <span class="s1">&#39;parks_percent_change_from_baseline&#39;</span><span class="p">,</span>
           <span class="s1">&#39;transit_stations_percent_change_from_baseline&#39;</span><span class="p">,</span>
           <span class="s1">&#39;workplaces_percent_change_from_baseline&#39;</span><span class="p">,</span>
           <span class="s1">&#39;residential_percent_change_from_baseline&#39;</span><span class="p">]</span>

<span class="n">markers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span>
<span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">data_path</span><span class="si">}</span><span class="s1">/2020_US_Region_Mobility_Report.csv&#39;</span><span class="p">,</span>
                 <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sub_region_1&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">classes</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">classes</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">5</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df_full</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>

<span class="c1"># for state in state_date.columns:</span>
<span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;US&#39;</span><span class="p">,</span> <span class="s1">&#39;Arizona&#39;</span><span class="p">]:</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)):</span>
        <span class="n">category</span> <span class="o">=</span> <span class="n">classes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">marker</span> <span class="o">=</span> <span class="n">markers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">state_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">df_full</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">category</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>

        <span class="n">US_avg</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">date_pt</span><span class="p">,</span> <span class="n">date_df</span> <span class="ow">in</span> <span class="n">df_full</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">):</span>
            <span class="n">US_avg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date_df</span><span class="p">[</span><span class="n">category</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>

        <span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;US&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">US_avg</span>
        <span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;US_rolling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;US&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_rolling&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="n">state_date</span><span class="p">[</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">state_date</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">category</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;transit&quot;</span><span class="p">:</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_rolling&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_percent&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.06</span><span class="p">)</span>

            <span class="n">ts</span> <span class="o">=</span> <span class="n">find_ts</span><span class="p">(</span><span class="n">state_date</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_rolling&#39;</span><span class="p">,</span> <span class="s1">&#39;index_num&#39;</span><span class="p">]],</span> <span class="n">state</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t0&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t1&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t2&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t3&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t3&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t4&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t4&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

            <span class="n">y_lim</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">80</span><span class="p">)]</span>
            <span class="n">text_y</span> <span class="o">=</span> <span class="n">y_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">3</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">y_lim</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">text_y</span><span class="p">),</span>
                         <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;t0:</span><span class="si">{</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;t0&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                         <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>


            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.2</span><span class="p">,</span> <span class="n">text_y</span><span class="p">),</span>
                         <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;t1:</span><span class="si">{</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;t1&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                         <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>


            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.2</span><span class="p">,</span> <span class="n">text_y</span><span class="p">),</span>
                         <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;t2:</span><span class="si">{</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;t2&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                         <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>


            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t3&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.2</span><span class="p">,</span> <span class="n">text_y</span><span class="p">),</span>
                         <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;t3:</span><span class="si">{</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;t3&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                         <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>


            <span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t4&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.2</span><span class="p">,</span> <span class="n">text_y</span><span class="p">),</span>
                         <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;t4:</span><span class="si">{</span><span class="n">ts</span><span class="p">[</span><span class="s2">&quot;t4&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
                         <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.12</span><span class="p">))</span>

            <span class="c1"># dashline for anotations</span>
            <span class="n">dashlline_x</span> <span class="o">=</span> <span class="p">[</span><span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span>
                           <span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span>
                           <span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t2&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span>
                           <span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t3&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">],</span>
                           <span class="n">state_date</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;t4&#39;</span><span class="p">]][</span><span class="s1">&#39;index_num&#39;</span><span class="p">]]</span>

            <span class="n">dashlline_y</span> <span class="o">=</span> <span class="p">[</span><span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t0&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t1&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t2&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t3&#39;</span><span class="p">],</span> <span class="n">ts</span><span class="p">[</span><span class="s1">&#39;rate_t4&#39;</span><span class="p">]]</span>
            <span class="n">x_major_locator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">x_major_locator</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">dashlline_x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dashlline_x</span><span class="p">))</span> <span class="o">*</span> <span class="n">y_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dashlline_x</span><span class="p">))</span> <span class="o">*</span> <span class="n">y_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                      <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_rolling&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">category</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_percent&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">markevery</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">state_date</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.06</span><span class="p">)</span>
            <span class="n">x_major_locator</span> <span class="o">=</span> <span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">x_major_locator</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">state_date</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>



    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Percent Change from Baseline of 2020: </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Change Rate (%)&#39;</span><span class="p">)</span>  <span class="c1"># change font size: fontsize=20</span>
    <span class="c1"># plt.show()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">fig_path</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s1">_multi_category.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Here is the plot of transit DQQ time points compare to other categories:</p>
<p><img alt="" src="_images/US_multi_category.png" /></p>
<p>As shown in the figure, the similar pattern of DQQ could be observed in all categories other than the residential and parks, which has increased value of citizen density since the remote working.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading">#</a></h2>
<p>This study contributes to the understanding of the effect of COVID-19 on U.S. mobility patterns by providing a comprehensive analysis of Google Community Mobility Reports data across various mobility categories. The findings demonstrate the pandemic’s significant and varied impact on different aspects of mobility, with implications for policymakers and future research on the long-term consequences of the pandemic on human mobility.</p>
<p>Our analysis revealed that the retail and recreation, transit stations, and workplaces categories experienced the most substantial reductions in mobility during the pandemic. These sectors were highly vulnerable to the effects of social distancing measures and lockdowns. In contrast, the residential category saw increased mobility as people adapted to remote work and stay-at-home orders.</p>
<p>The time-series analysis demonstrated a strong association between mobility changes and key pandemic events, such as lockdowns and reopening phases. However, mobility patterns exhibited a high degree of variation across states and over time, reflecting differing policy responses and regional characteristics. This highlights the importance of considering regional variations when designing policies and interventions to address the pandemic’s impact on mobility.</p>
<p>As the COVID-19 pandemic continues to evolve, it is crucial to monitor mobility trends and adapt policies accordingly. Future research could explore the long-term implications of the pandemic on mobility, such as potential shifts in work-from-home policies, urban planning, and transportation infrastructure. Additionally, examining the role of vaccination campaigns in shaping mobility trends can provide valuable insights for policymakers as they navigate the ongoing pandemic and its aftermath.</p>
<p>In order to understand the mechanism of epidemic spread on the community mobility, we modelled the demand-service relationship using the DQQ model which analyze disruptions and recoveries in complex systems in different contexts, such as the impact of natural disasters, pandemic outbreaks, and other major events. The model can help decision-makers and practitioners develop strategies to mitigate the impact of disruptions, improve the resilience of systems, and enhance the recovery process. Furthermore, the model can be used to evaluate the effectiveness of different policies and interventions aimed at minimizing disruptions and accelerating the recovery process.</p>
<p>In conclusion, this study offers a comprehensive analysis of the effect of COVID-19 on U.S. mobility patterns using Google Community Mobility Reports data. The findings underscore the pandemic’s significant and multifaceted impact on various aspects of mobility, emphasizing the importance of tailored policy interventions and continued research to better understand and address the long-term consequences of the pandemic on human mobility.</p>
</section>
<section id="contribution-statement">
<h2>Contribution statement<a class="headerlink" href="#contribution-statement" title="Permalink to this heading">#</a></h2>
<p>Lei Zhang:</p>
<ul class="simple">
<li><p>prepared / cleaned data for analysis</p></li>
<li><p>conducted mobility trends correlation analysis</p></li>
<li><p>conducted mobility trends by date analysis</p></li>
<li><p>conducted mobility trends by year_month analysis</p></li>
<li><p>conducted mobility trends by state analysis</p></li>
<li><p>created <code class="docutils literal notranslate"><span class="pre">utils.py</span></code> file</p></li>
</ul>
<p>June Lee:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Social</span> <span class="pre">Productivity-Related</span> <span class="pre">Mobility</span> <span class="pre">Trends</span></code> Section</p></li>
<li><p>Analyzed <code class="docutils literal notranslate"><span class="pre">residential</span></code> and <code class="docutils literal notranslate"><span class="pre">workplaces</span></code> part</p></li>
<li><p>Make <code class="docutils literal notranslate"><span class="pre">Makefile</span></code></p></li>
<li><p>fixed <code class="docutils literal notranslate"><span class="pre">utils.py</span></code> file</p></li>
<li><p>Created <code class="docutils literal notranslate"><span class="pre">contribution-statement.md</span></code> file</p></li>
<li><p>Fixed binder link</p></li>
</ul>
<p>Haoyu Liu:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Dependency</span> <span class="pre">Analysis</span></code> Section</p></li>
<li><p>Analyzed the relationship of COVID cases and gathering bans (<code class="docutils literal notranslate"><span class="pre">CasesAndPolicies.ipynb</span></code>).</p></li>
<li><p>Made environment</p></li>
<li><p>Created Jupyter Book</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">README.md</span></code> file</p></li>
<li><p>Created binder link</p></li>
<li><p>Contributed to <code class="docutils literal notranslate"><span class="pre">main.ipynb</span></code></p></li>
</ul>
<p>Han Wang:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Introduction</span></code>, <code class="docutils literal notranslate"><span class="pre">Mechanic</span> <span class="pre">Analysis</span> <span class="pre">based</span> <span class="pre">on</span> <span class="pre">Demand</span> <span class="pre">Modeling</span></code>, <code class="docutils literal notranslate"><span class="pre">Conclusion</span></code> Sections</p></li>
<li><p>Determined the dataset and topic, and organized the structure of the project</p></li>
<li><p>Analyzed the state-of-the-art researches and composed the literature review</p></li>
<li><p>Proposed the <a class="reference external" href="https://github.com/UCB-stat-159-s23/project-Group24/blob/main/Appendix%20A%20-%20DQQ.pdf">DQQ model</a> for the mechanism analysis</p></li>
<li><p>Publish the jupyter book and set up the continuous integration</p></li>
<li><p>Set up the LICENSE</p></li>
</ul>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this heading">#</a></h2>
<p>[1] Abraham C. Camba; Aileen L. Camba;  “The Effects of Restrictions in Economic Activity on The Spread of COVID-19 in The Philippines: Insights from Apple and Google Mobility Indicators”,   THE JOURNAL OF ASIAN FINANCE, ECONOMICS AND BUSINESS,  2020.</p>
<p>[2] Eric Halford; Anthony Dixon; Graham Farrell; Nicolas Malleson; Nick Tilley;  “Crime and Coronavirus: Social Distancing, Lockdown, and The Mobility Elasticity of Crime”,   CRIME SCIENCE,  2020.  (IF: 3)</p>
<p>[3] E Nurjani; K P Hafizha; D Purwanto; F Ulumia; M Widyastuti; A B Sekaranom; U Suarma;  “Carbon Emissions from The Transportation Sector During The Covid-19 Pandemic in The Special Region of Yogyakarta, Indonesia”,   IOP CONFERENCE SERIES: EARTH AND ENVIRONMENTAL SCIENCE,  2021.</p>
<p>[4] Terje Trasberg; James Cheshire;  “Spatial and Social Disparities in The Decline of Activities During The COVID-19 Lockdown in Greater London”,   URBAN STUDIES,  2021.  (IF: 3)
[5] Hafiz Suliman Munawar; Sara Imran Khan; Zakria Qadir; Abbas Z. Kouzani; M. A. Parvez Mahmud;  “Insight Into The Impact of COVID-19 on Australian Transportation Sector: An Economic and Community-Based Perspective”,   SUSTAINABILITY,  2021.  (IF: 3)</p>
<p>[6] Yuqin Jiang; Xiao Huang; Zhenlong Li;  “Spatiotemporal Patterns of Human Mobility and Its Association with Land Use Types During COVID-19 in New York City”,   ISPRS INT. J. GEO INF.,  2021.  (IF: 3)</p>
<p>[7] R Safitri; R Amelia;  “Forecasting Travel Patterns During COVID-19 Period Using Community Mobility Report Case Study: Bangka Belitung Province”,   IOP CONFERENCE SERIES: EARTH AND ENVIRONMENTAL SCIENCE,  2021.</p>
<p>[8] Dina Lusiana Setyowati; Muhammad Khairul Nuryanto; Muhammad Sultan; Lisda Sofia; Suwardi Gunawan; Agus Wiranto;  “COMPUTER VISION SYNDROME AMONG ACADEMIC COMMUNITY IN MULAWARMAN UNIVERSITY, INDONESIA DURING WORK FROM HOME IN COVID-19 PANDEMIC”,   ANNALS OF TROPICAL MEDICINE AND PUBLIC HEALTH,  2021.</p>
<p>[9] Aziman Abdullah;  “Lockdown Duration-based Impact Analysis Model of Residential Community Mobility Change and COVID-19 Cases in Malaysia”,   2021 INTERNATIONAL CONFERENCE ON INNOVATION AND …,  2021.</p>
<p>[10] Finn Petersen; Anna Errore; Pinar Karaca-Mandic;  “Lifting Statewide Mask Mandates and COVID-19 Cases: A Synthetic Control Study”,   MEDICAL CARE,  2022.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstract">Abstract</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-source">Data Source</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-analysis">Descriptive Analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation-analysis">Correlation Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#spatiotemporal-trends-analysis">Spatiotemporal Trends Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#temporal-trends-by-date">Temporal Trends by Date</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#retail-and-recreation">Retail and Recreation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parks">Parks</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#transit-stations">Transit Stations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#grocery-and-pharmacy">Grocery and Pharmacy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#residential">Residential</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#workplaces">Workplaces</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-trends-by-state">Spatial Trends by State</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Retail and Recreation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Parks</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Transit Stations</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Grocery and Pharmacy</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Residential</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Workplaces</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dependency-analysis">Dependency Analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analyze-covid-cases-by-state">Analyze covid cases by state</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#how-different-gathering-bans-affect-covid-affection-rate">How different gathering bans affect covid affection rate?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-covid-infection-rate-on-other-variables">regression covid infection rate on other variables</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#social-productivity-related-mobility-trends">Social Productivity-Related Mobility Trends</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mechanism-analysis-based-on-demand-modeling">Mechanism Analysis based on Demand Modeling</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contribution-statement">Contribution statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Group 24 Members
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>